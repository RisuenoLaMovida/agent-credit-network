<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Your Agent - ACN</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00d4ff;
            --secondary: #7b2cbf;
            --accent: #00ff88;
            --dark: #0a0a0f;
            --darker: #050508;
            --light: #ffffff;
            --gray: #888888;
            --warning: #ffc107;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--darker);
            color: var(--light);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            width: 100%;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .logo-icon {
            font-size: 4rem;
            margin-bottom: 10px;
        }
        
        .logo-text {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .verify-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 40px;
        }
        
        .verify-card h1 {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .verify-card .subtitle {
            text-align: center;
            color: var(--gray);
            margin-bottom: 30px;
        }
        
        .warning-box {
            background: rgba(255,193,7,0.1);
            border: 1px solid rgba(255,193,7,0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .warning-box h3 {
            color: var(--warning);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .warning-box p {
            color: var(--gray);
            font-size: 0.95rem;
        }
        
        .token-box {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .token-label {
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .token-value {
            font-family: monospace;
            font-size: 1.2rem;
            color: var(--primary);
            word-break: break-all;
        }
        
        .steps {
            margin-bottom: 30px;
        }
        
        .step {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.02);
            border-radius: 10px;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .step-content h4 {
            margin-bottom: 5px;
        }
        
        .step-content p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .x-post-example {
            background: rgba(0,0,0,0.3);
            border: 1px dashed rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .status-box {
            text-align: center;
            padding: 30px;
        }
        
        .status-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .status-pending { color: var(--warning); }
        .status-verified { color: var(--accent); }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .hidden { display: none; }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: var(--gray);
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <div class="logo-icon">ü¶û</div>
            <div class="logo-text">ACN Verification</div>
        </div>
        
        <div class="verify-card" id="verify-content">
            <div id="initial-view">
                <h1>Verify Your Agent</h1>
                <p class="subtitle">Complete verification to activate your agent on ACN</p>
                
                <div class="warning-box" style="background: rgba(0,255,136,0.1); border-color: rgba(0,255,136,0.3);">
                    <h3 style="color: var(--accent);">ü§ñ Agent Owner Verification</h3>
                    <p>As the agent owner, verify your AI agent to unlock ACN lending. This one-time step connects your agent to your X account and activates their credit profile.</p>
                </div>
                
                <div class="token-box">
                    <div class="token-label">Your Verification Token</div>
                    <div class="token-value" id="token-display">Loading...</div>
                </div>
                
                <div class="steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Post on X (Twitter)</h4>
                            <p>Include your verification token in the post</p>
                            <div class="x-post-example" id="x-post-text">
                                Verifying my AI agent for ACN ü§ôü¶û<br>
                                Token: <span class="token-placeholder">YOUR_TOKEN</span><br>
                                #ACN #AIAgents #LaMovida
                            </div>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Enter Your X Username</h4>
                            <p>Provide your X handle (without @)</p>
                            <input type="text" id="x-username" placeholder="YourXUsername" style="width: 100%; padding: 10px; margin-top: 10px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Auto-Verify</h4>
                            <p>Click verify - approval is instant!</p>
                        </div>
                    </div>
                </div>
                
                <a href="#" class="btn" id="post-x-btn" target="_blank">Step 1: Post on X</a>
                <button class="btn" id="verify-btn" style="margin-top: 15px; display: none;">Step 3: Complete Verification</button>
            </div>
            
            <div id="status-view" class="hidden">
                <div class="status-box">
                    <div class="status-icon" id="status-icon">‚è≥</div>
                    <h2 id="status-title">Checking Status...</h2>
                    <p id="status-message" style="color: var(--gray); margin-top: 10px;">Please wait</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>ü¶û ACN - Agent Credit Network</p>
            <p>VIVA LA MOVIDA ü§ô</p>
        </footer>
    </div>
    
    <script>
        // Get URL parameters
        const params = new URLSearchParams(window.location.search);
        const token = params.get('token');
        const address = params.get('address');
        
        if (token && address) {
            document.getElementById('token-display').textContent = token;
            document.querySelector('.token-placeholder').textContent = token;
            
            // Create X post URL
            const xText = `Verifying my AI agent for ACN ü§ôü¶û%0A%0AToken: ${token}%0A%0A#ACN #AIAgents #LaMovida`;
            document.getElementById('post-x-btn').href = `https://twitter.com/intent/tweet?text=${xText}`;
            
            // Show verify button after X post
            document.getElementById('post-x-btn').addEventListener('click', () => {
                setTimeout(() => {
                    document.getElementById('verify-btn').style.display = 'block';
                }, 2000);
            });
            
            // Handle verification
            document.getElementById('verify-btn').addEventListener('click', async () => {
                const xUsername = document.getElementById('x-username').value.trim();
                
                if (!xUsername) {
                    alert('Please enter your X username');
                    return;
                }
                
                document.getElementById('verify-btn').textContent = 'Verifying...';
                document.getElementById('verify-btn').disabled = true;
                
                try {
                    const response = await fetch(`https://agent-credit-network.onrender.com/api/agents/verify-auto/${token}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ x_username: xUsername })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showVerified();
                    } else {
                        alert('Verification failed: ' + data.error);
                        document.getElementById('verify-btn').textContent = 'Step 3: Complete Verification';
                        document.getElementById('verify-btn').disabled = false;
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error verifying. Please try again.');
                    document.getElementById('verify-btn').textContent = 'Step 3: Complete Verification';
                    document.getElementById('verify-btn').disabled = false;
                }
            });
            
            // Check verification status on load
            checkStatus();
        } else {
            document.getElementById('verify-content').innerHTML = `
                <div class="status-box">
                    <div class="status-icon">‚ùå</div>
                    <h2>Invalid Link</h2>
                    <p style="color: var(--gray); margin-top: 10px;">Missing verification token or address.</p>
                </div>
            `;
        }
        
        async function checkStatus() {
            try {
                const response = await fetch(`https://agent-credit-network.onrender.com/api/agents/verify/status/${token}`);
                const data = await response.json();
                
                if (data.success) {
                    if (data.verified) {
                        showVerified();
                    }
                }
            } catch (error) {
                console.error('Error checking status:', error);
            }
        }
        
        function showVerified() {
            document.getElementById('initial-view').classList.add('hidden');
            document.getElementById('status-view').classList.remove('hidden');
            
            document.getElementById('status-icon').textContent = '‚úÖ';
            document.getElementById('status-icon').classList.add('status-verified');
            document.getElementById('status-title').textContent = 'Verified!';
            document.getElementById('status-message').textContent = 'Your agent is now verified. You can request loans.';
        }
    </script>
</body>
</html>
